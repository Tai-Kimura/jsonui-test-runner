{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://jsonui.dev/schemas/screen-test.schema.json",
  "title": "JsonUI Screen Test",
  "description": "Schema for single-screen UI test cases (1:1 mapping with layout JSON)",
  "type": "object",

  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema"
    },

    "type": {
      "const": "screen",
      "description": "Test type identifier"
    },

    "source": {
      "type": "object",
      "description": "Source files this test is based on",
      "properties": {
        "layout": {
          "type": "string",
          "description": "Path to the JsonUI layout file (e.g., 'Layouts/Login.json')"
        },
        "spec": {
          "type": "string",
          "description": "Path to the specification document (e.g., 'specs/Login.md')"
        }
      },
      "required": ["layout"],
      "additionalProperties": false
    },

    "metadata": {
      "type": "object",
      "description": "Test metadata",
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable test name"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of what this test covers"
        },
        "generatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when this test was generated"
        },
        "generatedBy": {
          "type": "string",
          "description": "Agent or tool that generated this test"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Tags for filtering tests (e.g., ['smoke', 'regression'])"
        },
        "entry_screen": {
          "type": "boolean",
          "default": false,
          "description": "Mark this screen as an entry point (e.g., splash, login). Entry screens are positioned on the left in Mermaid flow diagrams."
        },
        "group": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ],
          "description": "Group name(s) for Mermaid diagram. Can be a string or array. When array, the screen appears in multiple group tabs."
        }
      },
      "required": ["name"],
      "additionalProperties": false
    },

    "platform": {
      "oneOf": [
        {
          "type": "string",
          "enum": ["ios", "android", "web", "all"]
        },
        {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["ios", "android", "web"]
          },
          "minItems": 1,
          "uniqueItems": true
        }
      ],
      "default": "all",
      "description": "Target platform(s) for this test"
    },

    "initialState": {
      "type": "object",
      "description": "Initial ViewModel state before test execution",
      "properties": {
        "viewModel": {
          "type": "object",
          "description": "Key-value pairs for ViewModel properties",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },

    "setup": {
      "type": "array",
      "description": "Steps to execute before each test case",
      "items": { "$ref": "actions.schema.json#/definitions/step" }
    },

    "teardown": {
      "type": "array",
      "description": "Steps to execute after each test case",
      "items": { "$ref": "actions.schema.json#/definitions/step" }
    },

    "cases": {
      "type": "array",
      "description": "Test cases for this screen",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Test case name"
          },
          "description": {
            "type": "string",
            "description": "What this test case verifies"
          },
          "descriptionFile": {
            "type": "string",
            "description": "Path to external description JSON file (relative to test file)"
          },
          "skip": {
            "type": "boolean",
            "default": false,
            "description": "Skip this test case"
          },
          "platform": {
            "oneOf": [
              {
                "type": "string",
                "enum": ["ios", "android", "web", "all"]
              },
              {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["ios", "android", "web"]
                },
                "minItems": 1,
                "uniqueItems": true
              }
            ],
            "description": "Override platform for this specific case"
          },
          "initialState": {
            "type": "object",
            "description": "Override initial state for this specific case",
            "properties": {
              "viewModel": {
                "type": "object",
                "additionalProperties": true
              }
            },
            "additionalProperties": false
          },
          "steps": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "actions.schema.json#/definitions/step" },
            "description": "Test steps (actions and assertions)"
          }
        },
        "required": ["name", "steps"],
        "additionalProperties": false
      },
      "minItems": 1
    }
  },

  "required": ["type", "source", "metadata", "cases"],
  "additionalProperties": false
}
